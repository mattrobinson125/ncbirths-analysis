---
title: "NCbirths Analysis"
author: "Matt Robinson, Athena Higgins, Ethan Sennett, Peter Nguyen"
date: "11/30/2016"
output:
  html_document:
    toc: yes
  pdf_document:
    toc: yes
---

```{r setup, echo=FALSE}
library(ggplot2)
library(Stat2Data)
library(splines)
library(knitr)
data(NCbirths)
NCbirths1<-na.omit(NCbirths)

```

\newpage

# 1. Group Analysis
## Project Overview

For our final project, based on the NCbirths dataset, we will explore factors related to childbirth data at a particular hospital. The NCbirths dataset includes the following variables that will be useful in exploring the stories contained in this dataset.

**Variable**   |  **Explanation**
-------------- | -----------------
MomAge         | The mothers age.
Marital        | The marital status of the mother. 1 = married, 2 = not married.
RaceMom        | Mother's race: 1=white, 2=black, 3=American Indian, 4=Chinese, 
&nbsp;         | 5=Japanese, 6=Hawaiian, 7=Filipino, 8=Other Asian or Pacific Islander
Gained         | The amount of weight gained during pregnancy (in pounds).
BirthWeightOz	 | The birth weight of the child (in ounces).
Weeks          | The number of completed weeks of gestation.
Plural         | Multiple birth indicator. 1=single birth, 2=twins, 3=triplets.



Examining relationships among these factors provides insight into the complexity of pregnancy for women and their infants, and the plethora of variables which influence childbirth. Some interesting relationships and interactions that we will explore in this report include:

1. The relationship between the mothers marital status, race and age.
2. The relationship between the mothers marital status, weight gained during pregnancy and age.
3. The relationship between the mothers marital status, the childs weight at birth and number of weeks of gestation.
4. The relationship between the mothers marital status, the childs weight at birth and whether or not the child was a twin or triplet.

Analyzing the data, through lenses shaped by these factors, allows us to tell intriguing social and biological stories about womenâ€™s pregnancy experiences. All of these analyses will incorporate marital status as a categorical factor to provide a comprehensive analysis of marital influence on pregnancy and childbirth.

We will use our analysis to prove or disprove the following hypotheses regarding marital status and pregnancy:

1. Hypothesis 1 -  Births involving a single mother will exhibit a higher weight gained during pregnancy, a lower average of weeks of gestation and a lower average child weight at birth.

2. Hypothesis / Exploration 2- Interpreting data related to marital status, race, and age will allow for an intriguing discussion of social factors related to childbirth, and insight into the influence of these factors on pregnancy. Marital status and race are not biological factors, and thus should have no physical influence on childbirth. When different patterns emerge in the childbirth data, with respect to these variables, trends could indicate the influence of social pressures and climate on childbirth. 

3. Hypothesis 3 - Births involving a married mother where the child will have a higher average birth weight, and will be a twin. On average, a married family will have a higher income than someone who is not married. When this is taken into account, food intake for the family is affected so by being married, the mother will be able to eat more and in turn the children will have a higher birth weight.



## Missing Data
```{r, echo=FALSE,eval=FALSE}
# Code for Missing Data
head(NCbirths[!complete.cases(NCbirths),])
```

Using R, we were able to find 41 observations where at least 1 variable had missing data. We decided to discard all 41 observations, since it wouldn't be taking too much away from the whole population in the dataset. Therefore, all of our visualizations and analyses use this cleaned dataset (NCbirths1).


## Visualization of Data

The below plots provide some basic visualiazations of the data collected. The sample collected for this dataset provides ample sample points for the various values the variables can take on.


```{r, fig.height=2, fig.width= 3.6, warning=FALSE, echo=FALSE}
ggplot(NCbirths1, aes(MomAge, Weeks, color=factor(MomRace))) + geom_point(size=.7) + labs(color="Race")

qplot(Gained, data = NCbirths1, geom = "density", color = factor(Marital)) + ylab("") + labs(color="Marital")
```

```{r fig.height = 3, fig.width = 3.6,echo=FALSE}
ggplot(NCbirths1, aes(MomAge, Marital, color = RaceMom)) + geom_point() 

ggplot(NCbirths1, aes(MomAge, Gained, color=factor(Marital))) + geom_point(size=0.7) + labs(color="Marital")
```

# 2. Individual Analyses

\newpage

##Work in Progress
##Athena's Work, Work in Progress

Variables to Consider: Marital Status, RaceMom, MomAge

Note:
RaceMom	1=white, 2=black, 3=American Indian, 4=Chinese, 5=Japanese, 6=Hawaiian, 7=Filipino, or 8=Other 

```{r}
NCbirths_white = subset(NCbirths1, RaceMom == 1)
NCbirths_black = subset(NCbirths1, RaceMom == 2)
NCbirths_american_indian = subset(NCbirths1, RaceMom == 3)
NCbirths_chinese = subset(NCbirths1, RaceMom == 4)
NCbirths_japanese = subset(NCbirths1, RaceMom == 5)
NCbirths_hawaiian = subset(NCbirths1, RaceMom == 6)
NCbirths_filipino = subset(NCbirths1, RaceMom == 7)
NCbirths_other = subset(NCbirths1, RaceMom == 8)
```

```{r}
ggplot(NCbirths1, aes(RaceMom)) + geom_histogram()

ggplot(NCbirths1, aes(MomAge, RaceMom, color = factor(Marital))) + geom_point() + ggtitle("Age, Race and Marital Status")

ggplot(NCbirths1, aes(MomAge, Marital, color = RaceMom)) + geom_point() 
```

Notes: This graphic demonstrates the pitfalls of conducting a convenience sample. The groups represented clearly neglects certain subsets of the population (for example, there is no data on Hawaiian individuals). There is one data point for the filipino race- this means that the entire set of statistics computed for this subset is based on one individual. It is important to keep this in mind when interpreting any statistics computed in the future. 

It is also fascinating to look at this distribution, further factored by marital status. We can dive into this exploration further, by comparing means for further subsets of the population. 

```{r, eval = FALSE, tidy = TRUE}

#Statistics on age, factored by Race
age_white <- summary(subset(NCbirths, RaceMom == 1, select = MomAge))
age_black <- summary(subset(NCbirths, RaceMom == 2, select = MomAge))
age_american_indian <- summary(subset(NCbirths, RaceMom == 3, select = MomAge))
age_chinese <- summary(subset(NCbirths, RaceMom == 4, select = MomAge))
age_japanese <- summary(subset(NCbirths, RaceMom == 5, select = MomAge))
age_hawaiian <- summary(subset(NCbirths, RaceMom == 6, select = MomAge))
age_filipino <- summary(subset(NCbirths, RaceMom == 7, select = MomAge))
age_other <- summary(subset(NCbirths1, RaceMom == 8, select = MomAge))
```


The following are mean age values for new mothers, categorized by their race. 

```{r, tidy = TRUE, eval = FALSE}
#Additional Comparison of Means
population_mean =  summary(subset(NCbirths, select = MomAge))
white_mean = age_white[4]
black_mean = age_black[4]
american_indian_mean = age_american_indian[4]
chinese_mean = age_chinese[4]
japanese_mean = age_japanese[4]
hawaiian_mean = age_hawaiian[4]
filipino_mean = age_filipino[4]
other_mean = age_other[4]
```

Mean Values Computed: 

population_mean = 26.76
white_mean =27.92  
black_mean = 24.53  
american_indian_mean = 24.09  
chinese_mean = 31.0  
japanese_mean = 24.75  
hawaiian_mean = NaN  
filipino_mean = 37  
other_mean = 28.86



I applied several t-tests of the data, to evaluate if the difference in means for subsets of the populations is statistically significant. In these computations, pvalue is key, as pvalue provides the probability of obtaining a result equal to or more extreme than the observed outcome, given the the assumption that the null hypothesis is true. Throughout these ttest trials, the null hypothesis states that the difference in mean values is not statistically significant. 

The p-value is defined as the probability of obtaining a result equal to or "more extreme" than what was actually observed, when the null hypothesis is true. In frequentist inference, the p-value is widely used in statistical hypothesis testing, specifically in null hypothesis significance testing.

```{r, tidy = TRUE, eval = FALSE}

ttest_white_population <- t.test(subset(NCbirths, RaceMom == 1, select = MomAge), subset(NCbirths, select = MomAge))
t_white = ttest_white_population[3]

ttest_black_population <- t.test(subset(NCbirths, RaceMom == 2, select = MomAge), subset(NCbirths, select = MomAge))
t_black = ttest_black_population[3]

ttest_american_indian_population <- t.test(subset(NCbirths, RaceMom == 3, select = MomAge), subset(NCbirths, select = MomAge))
t_american_indian = ttest_american_indian_population[3]

ttest_chinese_population <- t.test(subset(NCbirths, RaceMom == 4, select = MomAge), subset(NCbirths, select = MomAge))
t_chinese = ttest_chinese_population[3]

ttest_japanese_population <- t.test(subset(NCbirths, RaceMom == 5, select = MomAge), subset(NCbirths, select = MomAge))
t_japanese = ttest_japanese_population[3]

#ttest_hawaiian_population <- t.test(subset(NCbirths, RaceMom == 6, select = MomAge), subset(NCbirths, select = MomAge))
#t_hawaiian = ttest_hawaiian_population

#ttest_filipino_population <- t.test(subset(NCbirths, RaceMom == 7, select = MomAge), subset(NCbirths, select = MomAge))
#t_filipino = ttest_filipino_population

ttest_other_population <- t.test(subset(NCbirths, RaceMom == 8, select = MomAge), subset(NCbirths, select = MomAge))
t_other = ttest_other_population[3]
```


TTest P-Values, difference in mom age between specific racial group and entire population

T_white p.value = 4.730464e-06
T_black p.value = 1.486671e-09
T_japanese p.value = 1.335714e-05
T_other p.value = 0.1550142
T_white_black p.value = 4.78133e-18
T_american_indian p.value = 0.03067128


Other types of T-tests

```{r, tidy = TRUE, eval = FALSE}
#T Test, Comparing MomaAge White and Black MomAge
ttest_white_black <- t.test(subset(NCbirths, RaceMom == 1, select = MomAge), subset(NCbirths, RaceMom == 2, select = MomAge))
t_white_black = ttest_white_black[3]

```

TTest, difference in mom age between different racial groups

T_white_black p.value = 4.78133e-18


T-Tests, Comparing MomAge between married and not-married women (factored by race)

```{r, tidy = TRUE, eval = FALSE}
#T Test, Entire Population- Married vs. Not-Married
ttest_population_married <- t.test(subset(NCbirths, Marital == 1, select = MomAge), subset(NCbirths, Marital == 2, select = MomAge))
t_population_agemarried = ttest_population_married[3]

#T Test, White- Married vs. Not-Married
ttest_white_married <- t.test(subset(NCbirths, RaceMom == 1 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 1 & Marital == 2, select = MomAge))
t_white_agemarried = ttest_white_married[3]

#T Test, Black- Married vs. Not-Married
ttest_black_married <- t.test(subset(NCbirths, RaceMom == 2 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 2 & Marital == 2, select = MomAge))
t_black_agemarried = ttest_black_married[3]

#T Test, American indian- Married vs. Not-Married
ttest_american_indian_married <- t.test(subset(NCbirths, RaceMom == 3 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 3 & Marital == 2, select = MomAge))
t_american_indian_agemarried = ttest_american_indian_married[3]

#T Test, chinese- Married vs. Not-Married
#NOT ENOUGH DATA
#ttest_chinese_married <- t.test(subset(NCbirths, RaceMom == 4 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 4 & Marital == 2, select = MomAge))
#t_chinese_agemarried = ttest_chinese_married[3]

#T Test, japanese- Married vs. Not-Married
ttest_japanese_married <- t.test(subset(NCbirths, RaceMom == 5 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 5 & Marital == 2, select = MomAge))
t_japanese_agemarried = ttest_japanese_married[3]

#T Test, hawaiian- Married vs. Not-Married
#NOT ENOUGH OBSERVATIONS
#ttest_hawaiian_married <- t.test(subset(NCbirths, RaceMom == 6 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 6 & Marital == 2, select = MomAge))
#t_hawaiian_agemarried = ttest_hawaiian_married[3]

#T Test, filipino- Married vs. Not-Married
#NOT ENOUGH OBSERVATIONS
#ttest_filipino_married <- t.test(subset(NCbirths, RaceMom == 7 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 7 & Marital == 2, select = MomAge))
#t_filipino_agemarried = ttest_filipino_married[3]

#T Test, other- Married vs. Not-Married
ttest_other_married <- t.test(subset(NCbirths, RaceMom == 8 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 8 & Marital == 2, select = MomAge))
t_other_agemarried = ttest_other_married[3]
```

Race and Marital Status

Note- 1 married, 2 not married

```{r, tidy = TRUE, eval = FALSE}

#T Test, White and Black MomAge
ttest_white_black <- t.test(subset(NCbirths, RaceMom == 1, select = Marital), subset(NCbirths, RaceMom == 2, select = Marital))
ttest_white_black[3]

#T Test, White- Married vs. Not-Married
ttest_white_married <- t.test(subset(NCbirths, RaceMom == 1 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 1 & Marital == 2, select = MomAge))
ttest_white_married[3]

#T Test, Black- Married vs. Not-Married
ttest_black_married <- t.test(subset(NCbirths, RaceMom == 2 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 2 & Marital == 2, select = MomAge))
ttest_black_married[3]

#T Test, American indian- Married vs. Not-Married
ttest_american_indian_married <- t.test(subset(NCbirths, RaceMom == 3 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 3 & Marital == 2, select = MomAge))
ttest_american_indian_married[3]

#T Test, chinese- Married vs. Not-Married
#NOT ENOUGH DATA
#ttest_chinese_married <- t.test(subset(NCbirths, RaceMom == 4 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 4 & Marital == 2, select = MomAge))
#ttest_chinese_married

#T Test, japanese- Married vs. Not-Married
ttest_japanese_married <- t.test(subset(NCbirths, RaceMom == 5 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 5 & Marital == 2, select = MomAge))
ttest_japanese_married[3]

#T Test, hawaiian- Married vs. Not-Married
#NOT ENOUGH OBSERVATIONS
#ttest_hawaiian_married <- t.test(subset(NCbirths, RaceMom == 6 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 6 & Marital == 2, select = MomAge))
#ttest_hawaiian_married

#T Test, filipino- Married vs. Not-Married
#NOT ENOUGH OBSERVATIONS
#ttest_filipino_married <- t.test(subset(NCbirths, RaceMom == 7 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 7 & Marital == 2, select = MomAge))
#ttest_filipino_married[3]

#T Test, other- Married vs. Not-Married
ttest_other_married <- t.test(subset(NCbirths, RaceMom == 8 & Marital == 1, select = MomAge), subset(NCbirths, RaceMom == 8 & Marital == 2, select = MomAge))
ttest_other_married[3]
```


TTest P-Values, difference in MomAge between Married and Non-married women

Population = 2.929577e-72 
white =  4.003403e-30
Black = 4.793121e-18
American Indian = 3.040416e-05
Japanese = 0.05769045
Other = 0.0001803798


\newpage

## Marital Status, Child Weight &  Weeks of Gestation
In this section, we will explore the relationship between the weight of the child at birth and the number of weeks of gestation. We will also use marital status as a categorical variable to explore whether or not there exists a relationship between marital status and child weight.

```{r, fig.height=2, fig.width= 3.7, warning=FALSE, echo=FALSE}
qplot(Weeks, data = NCbirths1, geom = "density", color = factor(Marital)) + ylab("") + labs(color="Marital")

qplot(BirthWeightOz, data = NCbirths1, geom = "density", color = factor(Marital)) + ylab("") + labs(color="Marital")
```

```{r, fig.height=3, fig.width=6.5, echo=FALSE}
ggplot(NCbirths1, aes(Weeks, BirthWeightOz, color=factor(Marital))) + geom_point() + geom_smooth(method='lm', se=FALSE) + labs(color="Marital")
```

The above plots confirm that the data we will be looking at is normally distributed. Some key insight we gain from the density plot on the right and the scatterplot on the bottom is that there exists a larger mean birth weight in births involving a married mother compared to births involving a non-married mother. By fitting a linear model, we can get a more tangible value for this relationship.

```{r, include=FALSE}
a = lm(BirthWeightOz ~ Weeks + Marital, data=NCbirths1)
b = lm(BirthWeightOz ~ ns(Weeks, df=4) + Marital, data=NCbirths1)
```
```{r, echo=FALSE}
kable(summary(a)$coef, digits=2)
```

From this linear model fit, we can see that for an increase of 1 week of gestation, we would expect a newborn to weigh, on average, 4.8 Oz more. Additionally, the marital coefficient tells us that, on average, non-married mothers birth children that weigh 6 Oz less than married mothers. An important statistic to pay attention to in a linear regression model is the adjusted R-squared value. This linear model was fit with an $R^2_{adj}$ value of 0.3581.

###Evaluation of Linear Regression Model

```{r, fig.height=1.5, fig.width= 3.2, warning=FALSE, echo=FALSE}
qplot(Weeks, a$residuals, data=NCbirths1) + geom_hline(yintercept=0, linetype=2)
ggplot(a, aes(a$residuals)) +
  geom_histogram(binwidth=10)
```

<<<<<<< HEAD
The above plots are useful for checking the conditions for linear regression models. From the right plot, we can see that there appears to be a normal distribution of residuals. The left plot gives us an indication that this relationship may not be linear, as there is a slope in the residuals plot. This could be due to missing data, as both the residual plot and the scatterplot from the beginning show us that there is a large amount of data collected on births involving 35 or more weeks of gestation, but not much data on lower weeks. Also, the sample size of only 1400 births could be limiting to this analysis, as birthweight obviously involves many factors. This could be a reason behind the non-linear relationship exhibited in the data. If we had more data, the model would be less influenced by high-leverage points on both the lower end and higher end of the spectrum. The median week is just 33.5 weeks, while from the first density plot we know that the mean week is around 39 weeks. This difference is significant, as the leverage of data points are affected by the distance from the median.

Playing around with some new regression code:
```{r}
#based on computation above, population_mean = 26.76
#PROBLEM WITH THIS- there is no order / meaning to organization of races (white, black, chinese...)
MomAgeFit_both <- lm((MomAge - 26.76) ~ RaceMom * Marital - 1, data = NCbirths1)
MomAgeFit_RaceMom <- lm((MomAge - 26.76) ~ RaceMom - 1, data = NCbirths1) 
anova(MomAgeFit_both)
#ggplot(NCbirths1, aes(Marital, MomAgeFit_both)) + geom_point()


```
=======
The above plots are useful for checking the conditions for linear regression models. From the right plot, we can see that there appears to be a normal distribution of residuals. The left plot gives us an indication that this relationship may not be linear, there appears to be a slight curve in the residuals plot. This could be due to missing data, as both the residual plot and the scatterplot from the beginning show us that there is a large amount of data collected on births involving 35 or more weeks of gestation, but not much data on lower weeks. If we had more data, the model would be less influenced by high-leverage points on both the lower end and higher end of the spectrum. 

```{r, fig.height=3, fig.width=6, echo=FALSE}
ggplot(NCbirths1, aes(Weeks, BirthWeightOz, color=factor(Marital))) + geom_point() + geom_smooth(method='lm', formula=y~splines::bs(x,4), se=FALSE) + labs(color="Marital")
```

```{r, fig.height=1.5, fig.width= 3.2, warning=FALSE, echo=FALSE}
qplot(Weeks, b$residuals, data=NCbirths1) + geom_hline(yintercept=0, linetype=2)
ggplot(b, aes(b$residuals)) +
  geom_histogram(binwidth=10)
```

We can fit a slightly better model using a natural spline, which fits a curved line to the data. This ends up explaining 8% more of the variability, yielding an $R^2_{adj}$ of 0.4246 when using 4 degrees of freedom. This new model also meets the model diagnostics criteria, and specifically fits the portion of the data with fewer sample points.
>>>>>>> origin/master
